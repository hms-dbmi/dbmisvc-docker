# Title: dbmisvc-docker
# Description: Builder for base image to be used for DBMI services
# Author: HMS DBMI Tech Core
# Version: 0.1.1
# Date: 2021-07-02

_SOURCES_:
  - DockerMake.base.yml
  - DockerMake.alpine.yml
  - DockerMake.debian.yml
  - DockerMake.ubuntu.yml

alpine:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine{{ ALPINE_VERSION|default('3.14') }}"
  build_args:
    ALPINE_VERSION: "{{ ALPINE_VERSION|default('3.14') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_build
    - base_base_build

alpine3.14:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.14"
  build_args:
    ALPINE_VERSION: 3.14
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_build
    - base_base_build

alpine3.13:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.13"
  build_args:
    ALPINE_VERSION: 3.13
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_build
    - base_base_build

alpine3.12:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.12"
  build_args:
    ALPINE_VERSION: 3.12
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_build
    - base_base_build

alpine3.11:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.11"
  build_args:
    ALPINE_VERSION: 3.11
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_build
    - base_base_build

alpine-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine{{ ALPINE_VERSION|default('3.14') }}"
  build_args:
    ALPINE_VERSION: "{{ ALPINE_VERSION|default('3.14') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.21.0"
  requires:
    - base_meta
    - alpine_nginx_modules_install
    - alpine_build
    - base_base_build

alpine3.14-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.14"
  build_args:
    ALPINE_VERSION: "3.14"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.21.0"
  requires:
    - base_meta
    - alpine_nginx_modules_install
    - alpine_build
    - base_base_build

alpine3.13-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.13"
  build_args:
    ALPINE_VERSION: 3.13
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.21.0"
  requires:
    - base_meta
    - alpine_nginx_modules_install
    - alpine_build
    - base_base_build

alpine3.12-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.12"
  build_args:
    ALPINE_VERSION: 3.12
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.21.0"
  requires:
    - base_meta
    - alpine_nginx_modules_install
    - alpine_build
    - base_base_build

alpine3.11-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-alpine3.11"
  build_args:
    ALPINE_VERSION: 3.11
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.21.0"
  requires:
    - base_meta
    - alpine_nginx_modules_install
    - alpine_build
    - base_base_build

debian:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-{{ DEBIAN_VERSION|default('bullseye') }}"
  build_args:
    DEBIAN_VERSION: "{{ DEBIAN_VERSION|default('bullseye') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian11:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-bullseye"
  build_args:
    DEBIAN_VERSION: bullseye
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian10:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-buster"
  build_args:
    DEBIAN_VERSION: buster
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian9:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-stretch"
  build_args:
    DEBIAN_VERSION: stretch
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-{{ DEBIAN_VERSION|default('bullseye') }}"
  build_args:
    DEBIAN_VERSION: "{{ DEBIAN_VERSION|default('bullseye') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.20.1-1~buster"
    NJS_VERSION: "1.20.1+0.6.1-1~buster"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian11-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-bullseye"
  build_args:
    DEBIAN_VERSION: bullseye
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.20.1-1~buster"
    NJS_VERSION: "1.20.1+0.6.1-1~buster"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian10-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-buster"
  build_args:
    DEBIAN_VERSION: buster
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.20.1-1~buster"
    NJS_VERSION: "1.20.1+0.6.1-1~buster"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian9-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-stretch"
  build_args:
    DEBIAN_VERSION: stretch
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.18.0-2~stretch"
    NJS_VERSION: "1.18.0.0.4.4-2~stretch"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-{{ DEBIAN_VERSION|default('bullseye') }}"
  build_args:
    DEBIAN_VERSION: "{{ DEBIAN_VERSION|default('bullseye') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian11-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-bullseye"
  build_args:
    DEBIAN_VERSION: bullseye
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian10-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-buster"
  build_args:
    DEBIAN_VERSION: buster
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian9-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-stretch"
  build_args:
    DEBIAN_VERSION: stretch
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_build
    - base_base_build

debian-slim-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-{{ DEBIAN_VERSION|default('bullseye') }}"
  build_args:
    DEBIAN_VERSION: "{{ DEBIAN_VERSION|default('bullseye') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.20.1-1~bullseye"
    NJS_VERSION: "1.20.1+0.7.0-1~bullseye"
    XSLT_VERSION: "1.20.1~bullseye"
    GEOIP_VERSION: "1.20.1~bullseye"
    PERL_VERSION: "1.20.1~bullseye"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian11-slim-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-bullseye"
  build_args:
    DEBIAN_VERSION: bullseye
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.20.1-1~bullseye"
    NJS_VERSION: "1.20.1+0.7.0-1~bullseye"
    XSLT_VERSION: "1.20.1~bullseye"
    GEOIP_VERSION: "1.20.1~bullseye"
    PERL_VERSION: "1.20.1~bullseye"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian10-slim-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-buster"
  build_args:
    DEBIAN_VERSION: buster
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.20.1-1~buster"
    NJS_VERSION: "1.20.1+0.7.0-1~buster"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

debian9-slim-zip:
  FROM: "python:{{ PYTHON_VERSION|default('3.9') }}-slim-stretch"
  build_args:
    DEBIAN_VERSION: stretch
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
    NGINX_VERSION: "1.18.0-2~stretch"
    NJS_VERSION: "1.18.0.0.4.4-2~stretch"
  requires:
    - base_meta
    - debian_nginx_modules_install
    - debian_build
    - base_base_build

ubuntu:
  FROM: "ubuntu:{{ UBUNTU_VERSION|default('20.04') }}"
  build_args:
    UBUNTU_VERSION: "{{ UBUNTU_VERSION|default('20.04') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - ubuntu_build
    - base_base_build

ubuntu20.04:
  FROM: "ubuntu:20.04"
  build_args:
    UBUNTU_VERSION: 20.04
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - ubuntu_build
    - base_base_build

ubuntu18.04:
  FROM: "ubuntu:18.04"
  build_args:
    UBUNTU_VERSION: 18.04
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.9') }}"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - ubuntu_build
    - base_base_build

_ALL_:
 - alpine
 - alpine3.14
 - alpine3.13
 - alpine3.12
 - alpine-zip
 - alpine3.14-zip
 - alpine3.13-zip
 - alpine3.12-zip
 - debian-slim
 - debian11-slim
 - debian10-slim
 - debian9-slim
 - debian8-slim
 - debian-slim-zip
 - debian11-slim-zip
 - debian10-slim-zip
 - debian9-slim-zip
 - debian8-slim-zip
 - debian
 - debian11
 - debian10
 - debian9
 - debian8
 - debian-zip
 - debian11-zip
 - debian10-zip
 - debian9-zip
 - debian8-zip
 - ubuntu
 - ubuntu20.04
 - ubuntu18.04
