# Title: dbmisvc-docker
# Description: Builder for base image to be used for DBMI services
# Author: HMS DBMI Tech Core
# Version: 0.5.1
# Date: 2021-07-02

_SOURCES_:
  - DockerMake.base.yml
  - DockerMake.alpine.yml
  - DockerMake.debian.yml
  - DockerMake.ubuntu.yml

_GLOBALS_: &globals
  NGINX_VERSION: "1.21.6"
  NGINX_NJS_VERSION: "0.7.4"
  NGINX_PKG_RELEASE: "1"

alpine:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-alpine{{ ALPINE_VERSION|default('3.18') }}"
  build_args:
    << : *globals
    ALPINE_VERSION: "{{ ALPINE_VERSION|default('3.18') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_prips_build
    - alpine_build
    - base_base_build

alpine3.18:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-alpine3.18"
  build_args:
    << : *globals
    ALPINE_VERSION: 3.18
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_prips_build
    - alpine_build
    - base_base_build

alpine3.17:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-alpine3.17"
  build_args:
    << : *globals
    ALPINE_VERSION: 3.17
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_prips_build
    - alpine_build
    - base_base_build

alpine3.16:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-alpine3.16"
  build_args:
    << : *globals
    ALPINE_VERSION: 3.16
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_prips_build
    - alpine_build
    - base_base_build

alpine3.15:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-alpine3.15"
  build_args:
    << : *globals
    ALPINE_VERSION: 3.15
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - alpine_nginx_install
    - alpine_prips_build
    - alpine_build
    - base_base_build

debian:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-{{ DEBIAN_CODENAME|default('bookworm') }}"
  build_args:
    << : *globals
    DEBIAN_CODENAME: "{{ DEBIAN_CODENAME|default('bookworm') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian12:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-bookworm"
  build_args:
    << : *globals
    DEBIAN_CODENAME: bookworm
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian11:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-bullseye"
  build_args:
    << : *globals
    DEBIAN_CODENAME: bullseye
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian10:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-buster"
  build_args:
    << : *globals
    DEBIAN_CODENAME: buster
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-slim-{{ DEBIAN_CODENAME|default('bookworm') }}"
  build_args:
    << : *globals
    DEBIAN_CODENAME: "{{ DEBIAN_CODENAME|default('bookworm') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian12-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-slim-bookworm"
  build_args:
    << : *globals
    DEBIAN_CODENAME: bookworm
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian11-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-slim-bullseye"
  build_args:
    << : *globals
    DEBIAN_CODENAME: bullseye
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

debian10-slim:
  FROM: "python:{{ PYTHON_VERSION|default('3.11') }}-slim-buster"
  build_args:
    << : *globals
    DEBIAN_CODENAME: buster
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
  requires:
    - base_meta
    - debian_nginx_install
    - debian_prips_build
    - debian_build
    - base_base_build

ubuntu:
  FROM: "ubuntu:{{ UBUNTU_VERSION|default('22.04') }}"
  build_args:
    << : *globals
    UBUNTU_VERSION: "{{ UBUNTU_VERSION|default('22.04') }}"
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
    UBUNTU_CODENAME: "{{ UBUNTU_CODENAME|default('focal') }}"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - debian_prips_build
    - ubuntu_build
    - base_base_build

ubuntu22.04:
  FROM: "ubuntu:22.04"
  build_args:
    << : *globals
    UBUNTU_VERSION: 22.04
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
    UBUNTU_CODENAME: "focal"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - debian_prips_build
    - ubuntu_build
    - base_base_build

ubuntu20.04:
  FROM: "ubuntu:20.04"
  build_args:
    << : *globals
    UBUNTU_VERSION: 20.04
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
    UBUNTU_CODENAME: "focal"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - debian_prips_build
    - ubuntu_build
    - base_base_build

ubuntu18.04:
  FROM: "ubuntu:18.04"
  build_args:
    << : *globals
    UBUNTU_VERSION: 18.04
    PYTHON_VERSION: "{{ PYTHON_VERSION|default('3.11') }}"
    UBUNTU_CODENAME: "bionic"
  requires:
    - base_meta
    - ubuntu_python_install
    - ubuntu_nginx_install
    - debian_prips_build
    - ubuntu_build
    - base_base_build

_ALL_:
 - alpine
 - alpine3.18
 - alpine3.17
 - alpine3.16
 - alpine3.15
 - debian-slim
 - debian12-slim
 - debian11-slim
 - debian10-slim
 - debian
 - debian12
 - debian11
 - debian10
 - ubuntu
 - ubuntu22.04
 - ubuntu20.04
 - ubuntu18.04
